{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@askvortsov/flarum-automod/webpack/bootstrap","webpack://@askvortsov/flarum-automod/webpack/runtime/compat get default export","webpack://@askvortsov/flarum-automod/webpack/runtime/define property getters","webpack://@askvortsov/flarum-automod/webpack/runtime/hasOwnProperty shorthand","webpack://@askvortsov/flarum-automod/webpack/runtime/make namespace object","webpack://@askvortsov/flarum-automod/external root \"flarum.core.compat['common/app']\"","webpack://@askvortsov/flarum-automod/./src/common/index.js","webpack://@askvortsov/flarum-automod/external root \"flarum.core.compat['common/extend']\"","webpack://@askvortsov/flarum-automod/external root \"flarum.core.compat['common/components/EditUserModal']\"","webpack://@askvortsov/flarum-automod/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@askvortsov/flarum-automod/external root \"flarum.core.compat['common/utils/ItemList']\"","webpack://@askvortsov/flarum-automod/./src/common/utils/managedGroups.js","webpack://@askvortsov/flarum-automod/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@askvortsov/flarum-automod/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@askvortsov/flarum-automod/external root \"flarum.core.compat['common/Component']\"","webpack://@askvortsov/flarum-automod/external root \"flarum.core.compat['common/components/GroupBadge']\"","webpack://@askvortsov/flarum-automod/./src/common/components/ManagedGroups.js","webpack://@askvortsov/flarum-automod/external root \"flarum.core.compat['Model']\"","webpack://@askvortsov/flarum-automod/external root \"flarum.core.compat['models/User']\"","webpack://@askvortsov/flarum-automod/./src/common/models/Criterion.js","webpack://@askvortsov/flarum-automod/./src/forum/index.js","webpack://@askvortsov/flarum-automod/./src/common/registerModels.js","webpack://@askvortsov/flarum-automod/./src/common/augmentEditUserModal.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/app'];","import app from 'flarum/common/app';\n\napp.initializers.add('askvortsov/flarum-automod', () => {\n  console.log('[askvortsov/flarum-automod] Hello, forum and admin!');\n});\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/EditUserModal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LoadingIndicator'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/ItemList'];","export default function managedGroups(criteria) {\n  const ids = criteria\n    .filter((criterion) => {\n      return criterion.actions();\n    })\n    .reduce((acc, criterion) => {\n      const ids = criterion\n        .actions()\n        .filter(\n          (a) => a.type === \"add_to_group\" || a.type === \"remove_from_group\"\n        )\n        .map((a) => a.settings[\"group_id\"]);\n      acc.push(...ids);\n\n      return acc;\n    }, []);\n\n  return Array.from(new Set(ids).values())\n    .map((groupId) => app.store.getById(\"groups\", groupId))\n    .filter((g) => g);\n}\n","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/GroupBadge'];","import Component from \"flarum/common/Component\";\nimport GroupBadge from \"flarum/common/components/GroupBadge\";\nimport managedGroups from \"../utils/managedGroups\";\n\nexport default class ManagedGroups extends Component {\n  view() {\n    const groups = managedGroups(this.attrs.criteria);\n    const user = this.attrs.user;\n\n    return (\n      <div className=\"ManagedGroups Form-group\">\n        <hr />\n        <h4>\n          {app.translator.trans(\n            \"askvortsov-automod.lib.managed_groups.header\"\n          )}\n        </h4>\n        <ul>\n          {groups.map((group) => (\n            <label className=\"checkbox\">\n              {user && (\n                <input\n                  type=\"checkbox\"\n                  checked={user.groups().includes(group)}\n                  disabled={true}\n                />\n              )}\n              {app.translator.trans(\n                \"askvortsov-automod.lib.managed_groups.group_item\",\n                {\n                  badge: GroupBadge.component({\n                    group,\n                    label: \"\",\n                  }),\n                  groupName: group.nameSingular(),\n                }\n              )}\n            </label>\n          ))}\n        </ul>\n        <p>\n          {app.translator.trans(\n            \"askvortsov-automod.lib.managed_groups.groups_not_editable\"\n          )}\n        </p>\n      </div>\n    );\n  }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['Model'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['models/User'];","import Model from \"flarum/Model\";\n\nexport default class Criterion extends Model {}\n\nObject.assign(Criterion.prototype, {\n  name: Model.attribute(\"name\"),\n  icon: Model.attribute(\"icon\"),\n  description: Model.attribute(\"description\"),\n  actions: Model.attribute(\"actions\"),\n  metrics: Model.attribute(\"metrics\"),\n  requirements: Model.attribute(\"requirements\"),\n  isValid: Model.attribute(\"isValid\"),\n  invalidActionSettings: Model.attribute(\"invalidActionSettings\"),\n  invalidRequirementSettings: Model.attribute(\"invalidRequirementSettings\"),\n});\n","import augmentEditUserModal from \"../common/augmentEditUserModal\";\nimport registerModels from \"../common/registerModels\";\n\napp.initializers.add(\"askvortsov/flarum-automod\", () => {\n  registerModels();\n  augmentEditUserModal();\n});\n","import Model from \"flarum/Model\";\nimport User from \"flarum/models/User\";\nimport Criterion from \"./models/Criterion\";\n\nexport default function registerModels() {\n  app.store.models.criteria = Criterion;\n\n  User.prototype.criteria = Model.hasMany(\"criteria\");\n}\n","import { extend, override } from \"flarum/common/extend\";\nimport EditUserModal from \"flarum/common/components/EditUserModal\";\nimport LoadingIndicator from \"flarum/common/components/LoadingIndicator\";\nimport ItemList from \"flarum/common/utils/ItemList\";\nimport managedGroups from \"./utils/managedGroups\";\nimport ManagedGroups from \"./components/ManagedGroups\";\n\nexport default function augmentEditUserModal() {\n  extend(EditUserModal.prototype, \"oninit\", function () {\n    this.loading = true;\n    app.store.find(\"criteria\").then((criteria) => {\n      managedGroups(criteria).forEach(\n        (group) => delete this.groups[group.id()]\n      );\n\n      this.loading = false;\n      m.redraw();\n    });\n  });\n\n  override(EditUserModal.prototype, \"fields\", function (original) {\n    if (this.loading) {\n      const items = new ItemList();\n      items.add(\"loading\", <LoadingIndicator></LoadingIndicator>);\n      return items;\n    }\n\n    const items = original();\n\n    items.add(\n      \"Criteria\",\n      <ManagedGroups\n        criteria={app.store.all(\"criteria\")}\n        user={this.attrs.user}\n      />,\n      10\n    );\n\n    return items;\n  });\n}\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","app","add","console","log","managedGroups","criteria","ids","filter","criterion","actions","reduce","acc","type","map","settings","push","apply","Array","from","Set","values","groupId","store","getById","g","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","_inheritsLoose","subClass","superClass","create","constructor","ManagedGroups","_Component","arguments","view","groups","this","attrs","user","m","className","translator","trans","group","checked","includes","disabled","badge","GroupBadge","label","groupName","nameSingular","Component","Criterion","_Model","Model","assign","name","icon","description","metrics","requirements","isValid","invalidActionSettings","invalidRequirementSettings","initializers","models","User","extend","EditUserModal","_this","loading","find","then","forEach","id","redraw","override","original","items","ItemList","LoadingIndicator","all"],"sourceRoot":""}